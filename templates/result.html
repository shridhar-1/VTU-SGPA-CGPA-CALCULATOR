<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your VTU Result</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
        body { font-family: 'Poppins', sans-serif; background: #f9fafb; padding: 20px; color: #111827; }
        
        /* The area that gets turned into a PDF */
        #download-area { max-width: 600px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        .header { text-align: center; margin-bottom: 20px; }
        .header h2 { margin: 0; font-size: 28px; font-weight: 800; color: #1f2937; }
        .header p { margin: 5px 0 0 0; font-weight: 600; color: #4b5563; }
        
        .sem-box { margin-top: 20px; background: #f3f4f6; padding: 15px; border-radius: 8px; border-left: 5px solid #1f2937; }
        .sem-box h3 { margin: 0 0 10px 0; font-size: 18px; display: flex; justify-content: space-between; }
        
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
        th, td { border: 1px solid #e5e7eb; padding: 10px; text-align: center; font-size: 14px; }
        th { background: #1f2937; color: white; font-weight: 600; }
        .grade-text { color: #2563eb; font-weight: bold; }

        /* The Buttons at the bottom */
        .btn-group { display: flex; gap: 15px; justify-content: center; margin-top: 30px; }
        button { padding: 14px 24px; border: none; border-radius: 100px; font-size: 16px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        .btn-back { background: #e5e7eb; color: #374151; }
        .btn-down { background: #111827; color: white; }
    </style>
</head>
<body>

    <div id="download-area">
        <div class="header">
            <h2>Grand CGPA: {{ data.cgpa }}</h2>
            <p>Total Credits Earned: {{ data.total_credits }}</p>
        </div>

        {% for sem in data.semesters %}
        <div class="sem-box">
            <h3><span>Semester {{ sem.semester }}</span> <span>SGPA: {{ sem.sgpa }}</span></h3>
            <table>
                <tr>
                    <th>Subject Code</th>
                    <th>Marks</th>
                    <th>Grade</th>
                    <th>Credits</th>
                </tr>
                {% for sub in sem.subjects %}
                <tr>
                    <td>{{ sub.code }}</td>
                    <td>{{ sub.marks }}</td>
                    <td class="grade-text">{{ sub.grade }}</td>
                    <td>{{ sub.credits }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    </div>

    <div class="btn-group" id="action-buttons">
        <button class="btn-back" onclick="window.location.href='/'">Go Back</button>
        <button class="btn-down" onclick="downloadPDF()">Download PDF</button>
    </div>

    <script>
        function downloadPDF() {
            const element = document.getElementById('download-area');
            const opt = {
                margin: 0.3,
                filename: 'VTU_Result_' + Math.floor(Date.now() / 1000) + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).output('blob').then(function(pdfBlob) {
                const blobUrl = window.URL.createObjectURL(pdfBlob);
                const link = document.createElement('a');
                link.style.display = 'none';
                link.href = blobUrl;
                link.download = opt.filename;
                document.body.appendChild(link);
                link.click();
                setTimeout(() => {
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(blobUrl);
                }, 200);
            });
        }
    </script>

</body>
</html>
